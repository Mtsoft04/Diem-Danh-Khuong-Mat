<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>ƒêi·ªÉm danh khu√¥n m·∫∑t - Camera Pro</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root {
    --bg: #000;
    --text: #0ff;
    --accent: #0f0;
    --card: rgba(0,255,255,0.05);
}
.light-mode {
    --bg: #f0f4ff;
    --text: #111827;
    --accent: #16a34a;
    --card: rgba(0,128,0,0.05);
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Roboto', sans-serif;
    min-height: 100vh;
    transition: all 0.3s;
    text-align: center;
}

.camera-box {
    max-width: 1100px;
    margin: 20px auto;
}

h1 {
    text-shadow: 0 0 20px var(--text);
    margin-bottom: 20px;
}

#video {
    width: 100%;
    border: 5px solid var(--text);
    border-radius: 20px;
    box-shadow: 0 0 30px var(--text);
}

.info {
    font-size: 1.8em;
    margin: 15px;
    padding: 10px;
    background: var(--card);
    border-radius: 15px;
}

.success {
    color: var(--accent);
    text-shadow: 0 0 10px var(--accent);
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%,100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.btn-custom {
    margin: 8px;
    padding: 12px 25px;
    font-size: 1.2em;
    border-radius: 12px;
}

#themeToggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 99;
}
</style>
</head>

<body>

<!-- Dark/Light Mode Toggle -->
<button id="themeToggle" class="btn btn-light btn-sm">üåô / ‚òÄ</button>

<div class="camera-box">
    <h1>ƒêI·ªÇM DANH KHU√îN M·∫∂T - REALTIME PRO</h1>
    <div id="status" class="info">ƒêang qu√©t khu√¥n m·∫∑t...</div>
    <img id="video" src="{{ url_for('video_feed') }}" alt="Camera">

    <div class="mt-4">
        <button onclick="capturePhoto()" class="btn btn-success btn-lg btn-custom">üì∏ Ch·ª•p ·∫£nh l∆∞u b·∫±ng ch·ª©ng</button>
        <a href="/" class="btn btn-warning btn-lg btn-custom">üè† Dashboard</a>
        <a href="/realtime" class="btn btn-info btn-lg btn-custom">üë• Xem danh s√°ch</a>
    </div>
</div>

<script>
const body = document.documentElement;
const toggleBtn = document.getElementById('themeToggle');
if(localStorage.getItem('themeMode') === 'light') body.classList.add('light-mode');
toggleBtn.addEventListener('click', ()=>{
    if(body.classList.contains('light-mode')){
        body.classList.remove('light-mode');
        localStorage.setItem('themeMode','dark');
    } else {
        body.classList.add('light-mode');
        localStorage.setItem('themeMode','light');
    }
});

// Ch·ª•p ·∫£nh l∆∞u b·∫±ng ch·ª©ng
function capturePhoto() {
    const img = document.getElementById('video');
    const canvas = document.createElement('canvas');
    canvas.width = img.naturalWidth;
    canvas.height = img.naturalHeight;
    canvas.getContext('2d').drawImage(img, 0, 0);
    canvas.toBlob(blob => {
        const form = new FormData();
        form.append('photo', blob, 'capture_' + new Date().getTime() + '.jpg');
        fetch('/save_capture', { method: 'POST', body: form })
            .then(r => r.json())
            .then(data => alert(data.message));
    });
}

// Hi·ªáu ·ª©ng √¢m thanh khi ƒëi·ªÉm danh
const audio = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=');
window.addEventListener('message', e => {
    if (e.data && e.data.type === 'attendance') {
        document.getElementById('status').innerHTML = `<span class="success">‚úì ${e.data.name} (${e.data.mssv}) - ${e.data.time}</span>`;
        audio.play();
    }
});
</script>

</body>
</html>
